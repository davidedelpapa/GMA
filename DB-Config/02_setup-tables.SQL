USE gma;

CREATE TABLE `Users`(
  `userid` INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `extra` VARCHAR(512) DEFAULT 'NULL'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `pkeys`(
  `id` INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY, 
  `userid` INT NOT NULL, 
  `pkey` VARCHAR(40)  UNIQUE NOT NULL,
  `extra` VARCHAR(512) DEFAULT 'NULL', 
  FOREIGN KEY (userid) REFERENCES Users(userid) 
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `SessionRecords` (
  `id` INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `ip` VARCHAR(40) NOT NULL,
  `session` VARCHAR(50) NOT NULL,
  `firstaccess` VARCHAR(25) NOT NULL,
  `lastaccess` VARCHAR(25) NOT NULL,
  `pkey` VARCHAR(40) NOT NULL,
  `extra` VARCHAR(255) DEFAULT 'NULL',
  FOREIGN KEY (pkey) REFERENCES pkeys(pkey)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `TileRecords` (
  `id` INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `sessionid` INTEGER NOT NULL,
  `timestamp` VARCHAR(25) NOT NULL,
  `z` INT(2) NOT NULL,
  `x` INT(8) NOT NULL,
  `y` INT(8) NOT NULL,
  FOREIGN KEY (sessionid) REFERENCES SessionRecords(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `CompiledRecords` (
  `id` INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `pkey` VARCHAR(40) NOT NULL,
  `timestamp` VARCHAR(14) NOT NULL,
  `tilecount` INTEGER DEFAULT '0',
  `uniqueviewers` INTEGER DEFAULT '0',
  `sessions` INTEGER  DEFAULT '0',
  `totaltime` INTEGER DEFAULT '0',
  `bounces` INTEGER DEFAULT '0',
  `zooms` INTEGER DEFAULT '0',
  `pans` INTEGER DEFAULT '0',
  FOREIGN KEY (pkey) REFERENCES pkeys(pkey)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
